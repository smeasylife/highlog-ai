# ğŸ“„ [claude.md](http://claude.md/): Goat Heaven Project Specification

## 1. Project Overview

- **Goal**: Gemini 2.5 Flashë¥¼ í™œìš©í•˜ì—¬ í•™ìƒë¶€ ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜ì„ ì œê³µí•˜ê³ , ì§€ì›ìì˜ ë‹µë³€ ê·¼ê±°ì™€ íŒë‹¨ ê¸°ì¤€ì„ ì§‘ìš”í•˜ê²Œ ë¬»ëŠ” **'ê¼¬ë¦¬ ì§ˆë¬¸(Tail Questions)'** ì‹œìŠ¤í…œì„ í†µí•´ ì‹¤ì „ ë©´ì ‘ ëŒ€ë¹„ë¥¼ ë„ì›€.
- **Core Value**: ë‹¨ìˆœ ì§ˆì˜ì‘ë‹µì„ ë„˜ì–´ì„  Deep-Dive ë¶„ì„ ë° ì‹¤ì‹œê°„ í”¼ë“œë°±.

---

## 2. Tech Stack

- **AI Engine**: Python 3.11+ / FastAPI / LangGraph
- **AI Model**: Gemini 2.5 Flash (ì „ ê³¼ì • ìˆ˜í–‰)
- **Embedding**: Google gemini-embedding-001 (3072ì°¨ì›)
- **Vector DB**: PostgreSQL 15 + pgvector (Metadata Filter: `record_id`, `category` í•„ìˆ˜)

---

## 3. Workflow Design

### 3.1 Phase 1: Upload & Vectorization (Trigger: Upload Button)

- **Mechanism**: SSE(Server-Sent Events) ìŠ¤íŠ¸ë¦¬ë°ì„ í†µí•œ ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì „ì†¡.
- **S3 Upload**: Client â†’ S3 ì§ì ‘ ì—…ë¡œë“œ (Presigned URL í™œìš©).
- **Ingestion Logic**: PDF â†’ ì´ë¯¸ì§€ ë³€í™˜(PyMuPDF) â†’ Gemini 2.5 Flash ì¹´í…Œê³ ë¦¬ë³„ ì²­í‚¹ â†’ Embedding ë° ì €ì¥.
- **ğŸš¨ Hallucination ë°©ì§€**:
    - ì´ë¯¸ì§€ í…ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ ì¶”ì¶œ (ì¶”ì¸¡/ìš”ì•½/Paraphrase ê¸ˆì§€).
    - ë¶ˆë¶„ëª…í•œ í…ìŠ¤íŠ¸ëŠ” `[ì¼ë¶€ í…ìŠ¤íŠ¸ ëˆ„ë½]` ì²˜ë¦¬.
    - í‘œ ë°ì´í„°(ìˆ«ì, ë‚ ì§œ, ì ìˆ˜)ì˜ ì ˆëŒ€ì  ì •í™•ë„ ìœ ì§€.

### 3.2 Phase 2: Bulk Question Generation (Trigger: Generate Button)

1. **SSE Handshake**: Spring Boot - FastAPI ê°„ ìŠ¤íŠ¸ë¦¼ ì—°ê²°.
2. **Metadata Search**: `record_id` ê¸°ë°˜ `record_chunks` í…Œì´ë¸” ì¹´í…Œê³ ë¦¬ë³„ ì§ì ‘ ì¡°íšŒ.
3. **Generator**: Gemini 2.5 Flashê°€ ì˜ì—­ë³„ ì§ˆë¬¸(5ê°œ ì´í•˜), ëª¨ë²” ë‹µì•ˆ, ì§ˆë¬¸ ëª©ì  ìƒì„±.
4. **Finalization**: `questions` í…Œì´ë¸” ë²Œí¬ ì €ì¥ í›„ ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ.

---

## 4. AI Interviewer Technical Specification

ë™ì¼í•œ **LangGraph Logic**ì„ ê³µìœ í•˜ë˜, ì…ì¶œë ¥ ì²˜ë¦¬ë§Œ ë¶„ë¦¬ëœ ë‘ ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìš´ì˜í•¨.

### **[API 1] Text-Based Interview (`/chat/text`)**

- **Input**: ì‚¬ìš©ìì˜ í…ìŠ¤íŠ¸ ë‹µë³€, ì†Œìš” ì‹œê°„, í˜„ì¬ ìƒíƒœ(State).
- **Process**: LangGraph â†’ `analyzer` â†’ `generator` â†’ Text Output.
- **Output**: ë‹¤ìŒ ì§ˆë¬¸ í…ìŠ¤íŠ¸, ì—…ë°ì´íŠ¸ëœ ìƒíƒœ(State), ì‹¤ì‹œê°„ ë¶„ì„ ë°ì´í„°.

### **[API 2] Audio-Based Interview (`/chat/audio`)**

- **Input**: ì‚¬ìš©ìì˜ ìŒì„± íŒŒì¼(Multipart/form-data), ì†Œìš” ì‹œê°„, í˜„ì¬ ìƒíƒœ(State).
- **Process**:
    1. **STT**: Gemini 2.5 Flash Native Audioë¥¼ í†µí•´ ìŒì„± íŒŒì¼ì„ í…ìŠ¤íŠ¸ë¡œ ì¦‰ì‹œ ë³€í™˜.
    2. **Graph**: ë³€í™˜ëœ í…ìŠ¤íŠ¸ë¡œ ë™ì¼í•œ LangGraph ë¡œì§ ìˆ˜í–‰.
    3. **TTS**: ìƒì„±ëœ ì§ˆë¬¸ í…ìŠ¤íŠ¸ë¥¼ Google Cloud TTSë¥¼ í†µí•´ ê³ ìŒì§ˆ ìŒì„± íŒŒì¼ë¡œ ë³€í™˜.
- **Output**: ë‹¤ìŒ ì§ˆë¬¸ ìŒì„± íŒŒì¼(URL), ì§ˆë¬¸ í…ìŠ¤íŠ¸, ì—…ë°ì´íŠ¸ëœ ìƒíƒœ(State), ì‹¤ì‹œê°„ ë¶„ì„ ë°ì´í„°.

### 4.1 Interview Flow

- **Trigger**: í”„ë¡ íŠ¸ì—”ë“œì˜ "ìê¸°ì†Œê°œ ë¶€íƒë“œë¦½ë‹ˆë‹¤" ë©˜íŠ¸ í›„ ì‚¬ìš©ìì˜ **ì²« ë‹µë³€** ì‹œ LangGraph êµ¬ë™.
- **UI/UX**: ì‹¤ì‹œê°„ ì±—ë´‡ í˜•íƒœ, íƒ€ì´ë¨¸ ì •ë³´ ë° ë‹µë³€ ì†Œìš” ì‹œê°„ ë°ì´í„° ë™ê¸°í™”.

### 4.2 State Definition

```python
class InterviewState(TypedDict):
    difficulty: str            # ë©´ì ‘ ë‚œì´ë„ (Easy, Normal, Hard)
    remaining_time: int        # ë‚¨ì€ ì‹œê°„ (ì´ˆ ë‹¨ìœ„)
    interview_stage: str       # [INTRO, MAIN, WRAP_UP]

    conversation_history: List[BaseMessage]
    current_context: List[str] # í˜„ì¬ ì§ˆë¬¸/ì£¼ì œì™€ ê´€ë ¨ëœ í•™ìƒë¶€ ì²­í¬ ë¦¬ìŠ¤íŠ¸ (Multi-chunk)
    current_sub_topic: str     # í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì„¸ë¶€ ì£¼ì œ (ì˜ˆ: 'ë¦¬ë”ì‹­', 'ë´‰ì‚¬')
    asked_sub_topics: List[str]# ì´ë¯¸ ì™„ë£Œëœ ì„¸ë¶€ ì£¼ì œ ë¦¬ìŠ¤íŠ¸

    answer_metadata: List[Dict] # ê° ì§ˆë¬¸ë³„ [ë‹µë³€ì‹œê°„, í‰ê°€, ê°œì„ í¬ì¸íŠ¸] ë”•ì…”ë„ˆë¦¬ ë¦¬ìŠ¤íŠ¸
    scores: Dict[str, int]     # [ì „ê³µì í•©ì„±, ì¸ì„±, ë°œì „ê°€ëŠ¥ì„±, ì˜ì‚¬ì†Œí†µ]
```
answer_metadataì˜ ê¶Œì¥ êµ¬ì¡°

analyzerê°€ ì´ ë°ì´í„°ë¥¼ ë„£ìŠµë‹ˆë‹¤. scoreì˜ ì ìˆ˜ë¥¼ ë³´ê³  ë¶„ê¸° ë¡œì§ì„ ê²°ì •í•©ë‹ˆë‹¤.
{
  "question_idx": 1,                // ì§ˆë¬¸ ìˆœì„œ
  "sub_topic": "ë¦¬ë”ì‹­",             // ì–´ë–¤ í•˜ìœ„ ì£¼ì œì˜€ëŠ”ì§€
  "question": "ë™ì•„ë¦¬ ë¶€ì¥ìœ¼ë¡œì„œ ê°ˆë“±ì„ í•´ê²°í•œ êµ¬ì²´ì ì¸ ì‚¬ë¡€ëŠ”?", 
  "answer": "íŒ€ì› ê°„ ì˜ê²¬ ì°¨ì´ê°€ ìˆì„ ë•Œ ì¤‘ê°„ì—ì„œ...", 
  "response_time": 45,              // í”„ë¡ íŠ¸ì—ì„œ ë„˜ê²¨ë°›ì€ ì´ˆ ë‹¨ìœ„ ì‹œê°„
  "evaluation": {
    "score": 85,                    // analyzer ë…¸ë“œì—ì„œ ë§¤ê¸´ ì ìˆ˜
    "grade": "ì¢‹ìŒ",                // ì¢‹ìŒ/ë³´í†µ/ê°œì„ 
    "feedback": "êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ë‚˜ ê²°ê³¼ê°€ í¬í•¨ë˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.",
    "strength_tags": ["ë…¼ë¦¬ì  êµ¬ì¡°", "ì°¨ë¶„í•œ íƒœë„"],
    "weakness_tags": ["êµ¬ì²´ì  ì‚¬ë¡€ ë¶€ì¡±"]
  },
  "context_used": ["í•™ìƒë¶€_ì²­í¬_ID_123", "í•™ìƒë¶€_ì²­í¬_ID_456"] // ê·¼ê±° ë°ì´í„° ì¶”ì ìš©
}

### 4.3 Graph Nodes & Conditional Logic

- **Nodes**:
    - `analyzer`: ë‹µë³€ ë¶„ì„ í›„ [ê¼¬ë¦¬ ì§ˆë¬¸ / ì£¼ì œ ì „í™˜ / ì¢…ë£Œ] ê²½ë¡œ ê²°ì •.
    - `retrieve_new_topic`: ë¯¸ì¤‘ë³µ í•˜ìœ„ ì£¼ì œ ëœë¤ ì„ íƒ í›„ ë²¡í„° DBì—ì„œ ìƒˆë¡œìš´ ì²­í¬ ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰.
    - `follow_up_generator`: `current_context` ìœ ì§€í•˜ë©° êµ¬ì²´ì  ê·¼ê±°(Why) ë° íŒë‹¨ ê¸°ì¤€ ì§ˆë¬¸ ìƒì„±.
    - `new_question_generator`: ìƒˆë¡œìš´ ì£¼ì œ ì²­í¬ ê¸°ë°˜ ì²« ì§ˆë¬¸ ìƒì„±.
    - `wrap_up`: 10ë¶„ ì´ˆê³¼ ë˜ëŠ” ì£¼ì œ ì†Œì§„ ì‹œ ìµœì¢… ê²°ê³¼ ë°ì´í„° ìƒì„±.
- **Conditional Logic (Analyzer)**:
    - **IF [ì¶©ì‹¤ë„ ë‚®ìŒ/êµ¬ì²´ì„± ë¶€ì¡±]**: â†’ `follow_up_generator` (ê¼¬ë¦¬ ì§ˆë¬¸)
    - **IF [ì¶©ì‹¤ë„ ë†’ìŒ/ì£¼ì œ ì†Œì§„(3íšŒ ì´ìƒ)]**: â†’ `retrieve_new_topic` (ì£¼ì œ ì „í™˜)
    - **IF [ë‚¨ì€ ì‹œê°„ < 30ì´ˆ]**: â†’ `wrap_up` (ì¢…ë£Œ)

## 5. Sub-Topic & RAG Strategy

### 5.1 í•˜ìœ„ ì£¼ì œ ê¸°ë°˜ ê²€ìƒ‰ ì „ëµ

| **í•˜ìœ„ ì£¼ì œ** | **ê²€ìƒ‰ ë° ì§ˆë¬¸ ê°€ì´ë“œë¼ì¸** |
| --- | --- |
| **ì¶œê²°** | ì§€ê°/ê²°ì„ íŒ¨í„´ ì‚¬ìœ  í™•ì¸ ë° ì„±ì‹¤ì„± ê²€ì¦. |
| **ì„±ì ** | ì „ê³µ ê³¼ëª© ì„±ì  ì¶”ì´ ë° í•™ë…„ë³„ ë³€í™” ì´ìœ  ë¶„ì„. |
| **ë™ì•„ë¦¬** | í”„ë¡œì íŠ¸ ë‚´ ì—­í• , ê¸°ìˆ ì  í•´ê²° ê³¼ì •, í˜‘ì—… ì‚¬ë¡€. |
| **ë¦¬ë”ì‹­** | ê°ˆë“± ìƒí™©ì—ì„œì˜ ë³¸ì¸ë§Œì˜ í•´ê²° ë©”ì»¤ë‹ˆì¦˜. |
| **ì¸ì„±/íƒœë„** | í–‰íŠ¹ ê¸°ë¡ ê¸°ë°˜ ë³¸ì¸ì˜ ëŒ€í‘œ íŠ¹ì„± ì—í”¼ì†Œë“œ ì¦ëª…. |
| **ì§„ë¡œ/ììœ¨** | ì§€ì› ì „ê³µ ê´€ì‹¬ ê³„ê¸°ì™€ í™œë™ ê°„ì˜ ì—°ê²°ê³ ë¦¬. |
| **ë…ì„œ** | ì–¸ê¸‰ëœ ë„ì„œê°€ ê°€ì¹˜ê´€ ë° íƒêµ¬ì— ë¯¸ì¹œ ì˜í–¥. |
| **ë´‰ì‚¬** | í™œë™ì˜ ì§€ì†ì„±, ë°°ìš´ ì  ë° ê³µë™ì²´ ì˜ì‹ ë³€í™”. |

### 5.2 ê¼¬ë¦¬ ì§ˆë¬¸ (Deep Dive) ë¡œì§

- **Context Utilization**: `current_context` ë‚´ ë‹¤ì¤‘ ì²­í¬ë¥¼ êµì°¨ ê²€ì¦í•˜ì—¬ ì§ˆë¬¸ ìƒì„±.
- **Focus**: í–‰ë™ì˜ **'íŒë‹¨ ê·¼ê±°'**ì™€ **'ë°°ìš´ ì '**ì„ ì§‘ìš”í•˜ê²Œ ìºë¬»ëŠ” ì§ˆë¬¸ ìƒì„±.
- **Difficulty**: `Hard` ëª¨ë“œ ì‹œ ë…¼ë¦¬ì  í—ˆì ì„ ì°Œë¥´ëŠ” ì••ë°• ì§ˆë¬¸ ìœ„ì£¼ êµ¬ì„±.

---

## 6. ê²°ê³¼ ë¶„ì„ ë° ìš”ì•½ (Wrap-up)

- **ì¢…í•© í‰ê°€**: ì „ì²´ ë‹µë³€ ì‹œê°„ í‰ê·  ë° ë…¼ë¦¬ì„± ì ìˆ˜ í•©ì‚°.
- **ê°•ì /ì•½ì  ì¶”ì¶œ**:
    - **ê°•ì **: ë‹µë³€ ì‹œê°„ì´ ì ì ˆí•˜ê³  êµ¬ì²´ì  ì‚¬ë¡€ê°€ í¬í•¨ëœ ì£¼ì œ.
    - **ì•½ì **: ë‹µë³€ ì§€ì—° í˜¹ì€ ê·¼ê±°ê°€ ë¹ˆì•½í–ˆë˜ ì£¼ì œ.
- **ê°œì„  í¬ì¸íŠ¸**: ì§ˆë¬¸ë³„ í”¼ë“œë°±(ê²°ë¡  ì¤‘ì‹¬ ë§í•˜ê¸°, ìˆ˜ì¹˜ í™œìš© ë“±) ìƒì„±.

## 7. Key Development Rules

- **Gemini Native Audio**: ë³„ë„ STT ì—†ì´ ìŒì„± íŒŒì¼ ì§ì ‘ Gemini 2.5 Flash ì „ë‹¬.
- **Professional TTS**: Google Cloud TTSë¥¼ í™œìš©í•œ ì‹ ë¢°ê° ìˆëŠ” ìŒì„± ìƒì„±.
- **Structured Output**: AI ì‘ë‹µì€ ë°˜ë“œì‹œ Pydantic ëª¨ë¸ì„ í†µí•œ JSON í¬ë§· ê°•ì œ.
- **Cost**: 10ë¶„ ë©´ì ‘ ê¸°ì¤€ ì•½ 26ì› ì˜ˆìƒ (1ì´ˆë‹¹ 32í† í° ê³„ì‚°).